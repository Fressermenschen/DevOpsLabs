# kubectl secret

## `kubectl create secret`
```
PS E:\projects\temp\k8s> kubectl create secret generic my-secrets --from-literal=username=tiny0wizard --from-literal=password=veryhardpassword
secret/my-secrets created
```
## `kubectl get secrets`
```
PS E:\projects\temp\k8s> kubectl get secrets
NAME                                    TYPE                 DATA   AGE
my-secrets                              Opaque               2      6s
sh.helm.release.v1.app-python-helm.v1   helm.sh/release.v1   1      94m
sh.helm.release.v1.helm.v1              helm.sh/release.v1   1      92m
```
## `kubectl get secrets`
```
PS E:\projects\temp\k8s> kubectl get secrets
Name:         my-secrets
Namespace:    default
Labels:       <none>
Annotations:  <none>

Type:  Opaque

Data
====
password:  16 bytes
username:  11 bytes
```
## `kubectl get secret my-secrets`
```
PS E:\projects\temp\k8s> kubectl get secret my-secrets -o jsonpath='{.data}'
{"password":"dmVyeWhhcmRwYXNzd29yZA==","username":"dGlueTB3aXphcmQ="}
```
## `echo "dmVyeWhhcmRwYXNzd29yZA==" | base64 --decode`

```
tiny0wizard@DESKTOP-U5IRIAH:~$ echo "dmVyeWhhcmRwYXNzd29yZA==" | base64 --decode
veryhardpassword
```

# helm secret

## `gpg --gen-key`

```
PS E:\projects\temp\k8s> gpg --gen-key
gpg (GnuPG) 2.4.0; Copyright (C) 2021 g10 Code GmbH
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

Замечание: "gpg --full-generate-key" вызывает полнофункциональный диалог создания ключа.

GnuPG должен составить идентификатор пользователя для идентификации ключа.

Ваше полное имя: Alexander
Адрес электронной почты: alekskedalo@gmail.com
Вы выбрали следующий идентификатор пользователя:

Сменить (N)Имя, (E)Адрес; (O)Принять/(Q)Выход? o
Необходимо получить много случайных чисел. Желательно, чтобы Вы
в процессе генерации выполняли какие-то другие действия (печать
    "Alexander <alekskedalo@gmail.com>"
на клавиатуре, движения мыши, обращения к дискам); это даст генератору
случайных чисел больше возможностей получить достаточное количество энтропии.
Необходимо получить много случайных чисел. Желательно, чтобы Вы
в процессе генерации выполняли какие-то другие действия (печать
на клавиатуре, движения мыши, обращения к дискам); это даст генератору
случайных чисел больше возможностей получить достаточное количество энтропии.
gpg: сертификат отзыва записан в 'C:\\Users\\Tiny Wizard\\AppData\\Roaming\\gnupg\\openpgp-revocs.d\\350D27940248F57FA80545FF1C8B2080B1AA39AE.rev'.
открытый и секретный ключи созданы и подписаны.

pub   ed25519 2023-02-10 [SC] [   годен до: 2025-02-09]
      350D27940248F57FA80545FF1C8B2080B1AA39AE
uid                      Alexander <alekskedalo@gmail.com>
sub   cv25519 2023-02-10 [E] [   годен до: 2025-02-09]
```

## `sops -p 350D27940248F57FA80545FF1C8B2080B1AA39AE secrets.yaml`

```
PS E:\projects\temp\k8s> sops -p 350D27940248F57FA80545FF1C8B2080B1AA39AE secrets.yaml
[PGP]    time="2023-02-10T13:14:30+03:00" level=warning msg="Deprecation Warning: GPG key fetching from a keyserver within sops will be removed in a future version of sops. See https://github.com/mozilla/sops/issues/727 for more information."
```

## `helm secrets view secrets.yaml` Windows

```
E:\projects\temp\k8s> helm secrets view secrets.yaml
Синтаксическая ошибка в имени файла, имени папки или метке тома.
Error: plugin "secrets" exited with error
```

## `helm secrets view secrets.yaml` Ubuntu wsl generated new key

```
tiny0wizard@DESKTOP-U5IRIAH:/mnt/e/projects/temp/k8s$ helm secrets view secrets.yaml
password: veryhardpassword
```

## `helm secrets install app-python ./app-python -n default -f ./secrets.yaml` Windows

```
PS E:\projects\temp\k8s> helm secrets install app-python ./app-python -n default -f ./secrets.yaml
Синтаксическая ошибка в имени файла, имени папки или метке тома.
Error: plugin "secrets" exited with error
```

Error most likely caused by space in username

Unable to fix

## `helm secrets install app-python ./app-python -n default -f ./secrets.yaml` Ubuntu wsl

```
tiny0wizard@DESKTOP-U5IRIAH:/mnt/e/projects/temp/k8s$ helm secrets install app-python ./app-python -n default -f ./secrets.yaml
Error: INSTALLATION FAILED: Kubernetes cluster unreachable: Get "https://127.0.0.1:61302/version": dial tcp 127.0.0.1:61302: connect: connection refused
removed './secrets.yaml.dec'
Error: plugin "secrets" exited with error
```

Minikube will not start on Ubuntu, don't care enough to spend more time on it

##3 k8s/app-python/templates/secrets.yaml and references to it have been removed in order to operate helm in the next part


# Resources management

## `kubectl describe pod` limits

```
Limits:
      cpu:     100m
      memory:  128Mi
    Requests:
      cpu:        100m
      memory:     128Mi
```

## 'kubectl describe pod' full

```
PS E:\projects\temp\k8s> kubectl describe pod app-python-8675789c9-2qk62
Name:             app-python-8675789c9-2qk62
Namespace:        default
Priority:         0
Service Account:  app-python
Node:             minikube/192.168.49.2
Start Time:       Fri, 10 Feb 2023 13:56:03 +0300
Labels:           app.kubernetes.io/instance=app-python
                  app.kubernetes.io/name=app-python
                  pod-template-hash=8675789c9
Annotations:      <none>
Status:           Running
IP:               10.244.0.33
IPs:
  IP:           10.244.0.33
Controlled By:  ReplicaSet/app-python-8675789c9
Containers:
  app-python:
    Container ID:   docker://7735b07351048e1333978df0c40ad8d1daa82f35681ba6e06a3d614284c88642
    Image:          tiny0wizard/app_python:latest
    Image ID:       docker-pullable://tiny0wizard/app_python@sha256:dd60c0c8996c2a50cb2f6fda504b4b56e9d575f7ca3559d93526bce9dff4c2a5
    Port:           5000/TCP
    Host Port:      0/TCP
    State:          Running
      Started:      Fri, 10 Feb 2023 13:56:03 +0300
    Ready:          True
    Restart Count:  0
    Limits:
      cpu:     100m
      memory:  128Mi
    Requests:
      cpu:        100m
      memory:     128Mi
    Liveness:     http-get http://:http/ delay=0s timeout=1s period=10s #success=1 #failure=3
    Readiness:    http-get http://:http/ delay=0s timeout=1s period=10s #success=1 #failure=3
    Environment:  <none>
    Mounts:
      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-m26v6 (ro)
Conditions:
  Type              Status
  Initialized       True
  Ready             True
  ContainersReady   True
  PodScheduled      True
Volumes:
  kube-api-access-m26v6:
    Type:                    Projected (a volume that contains injected data from multiple sources)
    TokenExpirationSeconds:  3607
    ConfigMapName:           kube-root-ca.crt
    ConfigMapOptional:       <nil>
    DownwardAPI:             true
QoS Class:                   Guaranteed
Node-Selectors:              <none>
Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s
                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s
Events:
  Type     Reason     Age   From               Message
  ----     ------     ----  ----               -------
  Normal   Scheduled  30s   default-scheduler  Successfully assigned default/app-python-8675789c9-2qk62 to minikube
  Normal   Pulled     31s   kubelet            Container image "tiny0wizard/app_python:latest" already present on machine
  Normal   Created    31s   kubelet            Created container app-python
  Normal   Started    31s   kubelet            Started container app-python
```