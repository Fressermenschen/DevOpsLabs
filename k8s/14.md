## Kube Prometheus Stack

The Prometheus Operator - automates Prometheus deployment for Kubernetes
Highly available Prometheus - collects and presents metrics from apps
Highly available Alertmanager - alert handler for apps
Prometheus node-exporter - exports hardware and OS metrics
Prometheus Adapter for Kubernetes Metrics APIs - links Prometheus to Kubernetes via API
kube-state-metrics - export of Kubernetes metrics via API
Grafana - dashboard for metric visualisation

## `kubectl get po,sts,svc,pvc,cm`

Command shows 
1. Pods
2. Statefulsets
3. Services
4. Persistent Volumes
5. Configmaps

```
PS E:\projects\temp\k8s> kubectl get po,sts,svc,pvc,cm
NAME                                                         READY   STATUS    RESTARTS     AGE
pod/alertmanager-monitoring-kube-prometheus-alertmanager-0   2/2     Running   1 (2m ago)   2m1s
pod/app-python-0                                             1/1     Running   0            12s
pod/app-python-1                                             1/1     Running   0            12s
pod/app-python-2                                             1/1     Running   0            12s
pod/helm-app-python-5654fbd547-bhb65                         1/1     Running   0            3h38m
pod/monitoring-grafana-8448c6c7b6-c58l4                      3/3     Running   0            2m4s
pod/monitoring-kube-prometheus-operator-8459ff867-4l4b8      1/1     Running   0            2m4s
pod/monitoring-kube-state-metrics-78b876647b-k2mcv           1/1     Running   0            2m4s
pod/monitoring-prometheus-node-exporter-w4twk                1/1     Running   0            2m4s
pod/prometheus-monitoring-kube-prometheus-prometheus-0       2/2     Running   0            2m1s

NAME                                                                    READY   AGE
statefulset.apps/alertmanager-monitoring-kube-prometheus-alertmanager   1/1     2m1s
statefulset.apps/app-python                                             3/3     12s
statefulset.apps/prometheus-monitoring-kube-prometheus-prometheus       1/1     2m1s

NAME                                              TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)
  AGE
service/alertmanager-operated                     ClusterIP   None             <none>        9093/TCP,9094/TCP,9094/UDP   2m1s
service/app-python                                ClusterIP   10.111.108.197   <none>        80/TCP
  13s
service/kubernetes                                ClusterIP   10.96.0.1        <none>        443/TCP
  3h38m
service/monitoring-grafana                        ClusterIP   10.105.111.125   <none>        80/TCP
  2m4s
service/monitoring-kube-prometheus-alertmanager   ClusterIP   10.109.206.141   <none>        9093/TCP
  2m4s
service/monitoring-kube-prometheus-operator       ClusterIP   10.110.221.204   <none>        443/TCP
  2m4s
service/monitoring-kube-prometheus-prometheus     ClusterIP   10.105.8.178     <none>        9090/TCP
  2m4s
service/monitoring-kube-state-metrics             ClusterIP   10.99.38.203     <none>        8080/TCP
  2m4s
service/monitoring-prometheus-node-exporter       ClusterIP   10.101.147.194   <none>        9100/TCP
  2m4s
service/prometheus-operated                       ClusterIP   None             <none>        9090/TCP
  2m1s

NAME                                                                     DATA   AGE
configmap/app-python-configmap                                           1      13s
configmap/kube-root-ca.crt                                               1      3d18h
configmap/monitoring-grafana                                             1      2m4s
configmap/monitoring-grafana-config-dashboards                           1      2m4s
configmap/monitoring-kube-prometheus-alertmanager-overview               1      2m4s
configmap/monitoring-kube-prometheus-apiserver                           1      2m4s
configmap/monitoring-kube-prometheus-cluster-total                       1      2m4s
configmap/monitoring-kube-prometheus-controller-manager                  1      2m4s
configmap/monitoring-kube-prometheus-etcd                                1      2m4s
configmap/monitoring-kube-prometheus-grafana-datasource                  1      2m4s
configmap/monitoring-kube-prometheus-grafana-overview                    1      2m4s
configmap/monitoring-kube-prometheus-k8s-coredns                         1      2m4s
configmap/monitoring-kube-prometheus-k8s-resources-cluster               1      2m4s
configmap/monitoring-kube-prometheus-k8s-resources-namespace             1      2m4s
configmap/monitoring-kube-prometheus-k8s-resources-node                  1      2m4s
configmap/monitoring-kube-prometheus-k8s-resources-pod                   1      2m4s
configmap/monitoring-kube-prometheus-k8s-resources-workload              1      2m4s
configmap/monitoring-kube-prometheus-k8s-resources-workloads-namespace   1      2m4s
configmap/monitoring-kube-prometheus-kubelet                             1      2m4s
configmap/monitoring-kube-prometheus-namespace-by-pod                    1      2m4s
configmap/monitoring-kube-prometheus-namespace-by-workload               1      2m4s
configmap/monitoring-kube-prometheus-node-cluster-rsrc-use               1      2m4s
configmap/monitoring-kube-prometheus-node-rsrc-use                       1      2m4s
configmap/monitoring-kube-prometheus-nodes                               1      2m4s
configmap/monitoring-kube-prometheus-nodes-darwin                        1      2m4s
configmap/monitoring-kube-prometheus-persistentvolumesusage              1      2m4s
configmap/monitoring-kube-prometheus-pod-total                           1      2m4s
configmap/monitoring-kube-prometheus-prometheus                          1      2m4s
configmap/monitoring-kube-prometheus-proxy                               1      2m4s
configmap/monitoring-kube-prometheus-scheduler                           1      2m4s
configmap/monitoring-kube-prometheus-workload-total                      1      2m4s
configmap/prometheus-monitoring-kube-prometheus-prometheus-rulefiles-0   29     118s
```

## Grafana
Grafana is up and running but there is no data for questions 1-3

![Grafana](/k8s/screens/grafana.png?raw=true "Grafana")

4. 38 pods and 70 containers

![Kubelet](/k8s/screens/kubelet.png?raw=true "Kubelet")

5. No data on network

![Network](/k8s/screens/network.png?raw=true "Network")

6. 10 alerts

![Alerts](/k8s/screens/alerts.png?raw=true "Alerts")

## Init Containers

```
PS C:\Users\Tiny Wizard> kubectl exec -it app-python -- cat ./usr/share/nginx/html/index.html
Defaulted container "nginx" out of: nginx, install (init)
<html><head></head><body><header>
<title>http://info.cern.ch</title>
</header>

<h1>http://info.cern.ch - home of the first website</h1>
<p>From here you can:</p>
<ul>
<li><a href="http://info.cern.ch/hypertext/WWW/TheProject.html">Browse the first website</a></li>
<li><a href="http://line-mode.cern.ch/www/hypertext/WWW/TheProject.html">Browse the first website using the line-mode browser simulator</a></li>
<li><a href="http://home.web.cern.ch/topics/birth-web">Learn about the birth of the web</a></li>
<li><a href="http://home.web.cern.ch/about">Learn about CERN, the physics laboratory where the web was born</a></li>
</ul>
</body></html>
```